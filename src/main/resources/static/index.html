<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Web Messenger</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        #messages { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; }
        #inputArea { margin-top: 10px; }
    </style>
</head>
<body>

<h2>WebSocket Messenger</h2>

<div id="messages"></div>

<div id="inputArea">
    <input type="text" id="messageInput" placeholder="Введите сообщение..." style="width: 80%;">
    <button onclick="sendMessage()">Отправить</button>
</div>

<script>
    let socket = new WebSocket("http://" + window.location.host + "/ws/chat");

    socket.onmessage = function (event) {
        const msg = JSON.parse(event.data);
        const container = document.getElementById("messages");
        const line = document.createElement("div");
        line.textContent = `${msg.fromUsername || msg.fromUserId}: ${msg.content}`;
        container.appendChild(line);
        container.scrollTop = container.scrollHeight;
    };

    socket.onopen = function () {
        console.log("Соединение установлено");
    };

    socket.onclose = function () {
        console.log("Соединение закрыто");
    };

    function sendMessage() {
        const input = document.getElementById("messageInput");
        const message = {
            content: input.value,
            type: "CHAT"
        };
        socket.send(JSON.stringify(message));
        input.value = "";
    }
</script>

</body>
</html>
